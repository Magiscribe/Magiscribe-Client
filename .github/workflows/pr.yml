name: PR Checks 🏷️

on:
  pull_request:
    types: [opened, labeled, unlabeled, assigned, unassigned]

jobs:
  check-label:
    name: PR Label Check
    runs-on: ubuntu-latest

    steps:
      - name: Check out the repository
        uses: actions/checkout@v2

      - name: Check PR labels
        id: check_labels
        uses: actions/github-script@v4
        with:
          script: |
            const labels = context.payload.pull_request.labels.map(label => label.name);
            const requiredLabels = ["review-ready", "work-in-progress"];
            const hasRequiredLabel = labels.some(label => requiredLabels.includes(label));
            if (!hasRequiredLabel) {
              core.setFailed(`PR must have one of the following labels: ${requiredLabels.join(", ")}`);
            }

      - name: Set PR status
        if: failure()
        uses: actions/github-script@v4
        with:
          script: |
            const { context, github } = require('@actions/github');
            const { owner, repo } = context.repo;
            const pull_number = context.payload.pull_request.number;

            await github.issues.createComment({
              owner,
              repo,
              issue_number: pull_number,
              body: 'This PR does not have the required label. Please add either "review-ready" or "work-in-progress".'
            });

  check-assignee:
    name: PR Assignee Check
    runs-on: ubuntu-latest
    needs: check-label

    steps:
      - name: Check out the repository
        uses: actions/checkout@v2

      - name: Check PR assignee
        id: check_assignee
        uses: actions/github-script@v4
        with:
          script: |
            const assignees = context.payload.pull_request.assignees;
            if (assignees.length === 0) {
              core.setFailed('PR must have at least one assignee.');
            }

      - name: Set PR status
        if: failure()
        uses: actions/github-script@v4
        with:
          script: |
            const { context, github } = require('@actions/github');
            const { owner, repo } = context.repo;
            const pull_number = context.payload.pull_request.number;

            await github.issues.createComment({
              owner,
              repo,
              issue_number: pull_number,
              body: 'This PR does not have an assignee. Please assign at least one person to this PR.'
            });
